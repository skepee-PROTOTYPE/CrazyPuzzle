{"ast":null,"code":"// Platform-aware authentication wrapper\nimport{isFacebookInstantGame}from'./platform';class PlatformAuth{// Convert Firebase user to platform user\nfromFirebaseUser(user){return{uid:user.uid,displayName:user.displayName,email:user.email,photoURL:user.photoURL,platform:'web'};}// Get Facebook Instant Games player as platform user\nasync fromFacebookPlayer(){if(!isFacebookInstantGame()){return null;}try{const FBInstant=window.FBInstant;let playerId=FBInstant.player.getID();let playerName=FBInstant.player.getName();const playerPhoto=FBInstant.player.getPhoto();console.log('üîç Facebook API returns:',{playerId,playerName,playerPhoto,nameIsNull:playerName===null,nameIsEmpty:playerName===''});// Check if player ID is available - in test/dev environment it might be null\nif(!playerId){console.warn('‚ö†Ô∏è Facebook player ID is null - using test player ID');// Generate a test ID based on current time for development\nplayerId=\"test_\".concat(Date.now());}// getName() might return null if called too early or permission not granted\n// Use the actual name if available, otherwise create a fallback\nif(!playerName||playerName.trim()===''){console.warn('‚ö†Ô∏è Player name is null/empty, using fallback');playerName=playerId.startsWith('test_')?'Test Player':\"Player \".concat(playerId.substring(0,8));}console.log('‚úÖ Facebook player created:',{uid:\"fb_\".concat(playerId),displayName:playerName});return{uid:\"fb_\".concat(playerId),displayName:playerName,photoURL:playerPhoto||null,platform:'facebook'};}catch(error){console.error('Failed to get Facebook player info:',error);return null;}}// Generic method to get current user regardless of platform\nasync getCurrentUser(firebaseUser){if(isFacebookInstantGame()){return this.fromFacebookPlayer();}else{return firebaseUser?this.fromFirebaseUser(firebaseUser):null;}}}export const platformAuth=new PlatformAuth();","map":{"version":3,"names":["isFacebookInstantGame","PlatformAuth","fromFirebaseUser","user","uid","displayName","email","photoURL","platform","fromFacebookPlayer","FBInstant","window","playerId","player","getID","playerName","getName","playerPhoto","getPhoto","console","log","nameIsNull","nameIsEmpty","warn","concat","Date","now","trim","startsWith","substring","error","getCurrentUser","firebaseUser","platformAuth"],"sources":["C:/Users/MARCE/source/repos/CrazyPuzzle/web/src/platformAuth.ts"],"sourcesContent":["// Platform-aware authentication wrapper\r\n\r\nimport { User as FirebaseUser } from 'firebase/auth';\r\nimport { isFacebookInstantGame } from './platform';\r\n\r\nexport interface PlatformUser {\r\n  uid: string;\r\n  displayName: string | null;\r\n  email?: string | null;\r\n  photoURL?: string | null;\r\n  platform: 'web' | 'facebook';\r\n}\r\n\r\nclass PlatformAuth {\r\n  // Convert Firebase user to platform user\r\n  fromFirebaseUser(user: FirebaseUser): PlatformUser {\r\n    return {\r\n      uid: user.uid,\r\n      displayName: user.displayName,\r\n      email: user.email,\r\n      photoURL: user.photoURL,\r\n      platform: 'web'\r\n    };\r\n  }\r\n\r\n  // Get Facebook Instant Games player as platform user\r\n  async fromFacebookPlayer(): Promise<PlatformUser | null> {\r\n    if (!isFacebookInstantGame()) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const FBInstant = window.FBInstant!;\r\n      \r\n      let playerId = FBInstant.player.getID();\r\n      let playerName = FBInstant.player.getName();\r\n      const playerPhoto = FBInstant.player.getPhoto();\r\n      \r\n      console.log('üîç Facebook API returns:', { \r\n        playerId, \r\n        playerName, \r\n        playerPhoto,\r\n        nameIsNull: playerName === null,\r\n        nameIsEmpty: playerName === ''\r\n      });\r\n      \r\n      // Check if player ID is available - in test/dev environment it might be null\r\n      if (!playerId) {\r\n        console.warn('‚ö†Ô∏è Facebook player ID is null - using test player ID');\r\n        // Generate a test ID based on current time for development\r\n        playerId = `test_${Date.now()}`;\r\n      }\r\n\r\n      // getName() might return null if called too early or permission not granted\r\n      // Use the actual name if available, otherwise create a fallback\r\n      if (!playerName || playerName.trim() === '') {\r\n        console.warn('‚ö†Ô∏è Player name is null/empty, using fallback');\r\n        playerName = playerId.startsWith('test_') \r\n          ? 'Test Player' \r\n          : `Player ${playerId.substring(0, 8)}`;\r\n      }\r\n\r\n      console.log('‚úÖ Facebook player created:', { uid: `fb_${playerId}`, displayName: playerName });\r\n\r\n      return {\r\n        uid: `fb_${playerId}`,\r\n        displayName: playerName,\r\n        photoURL: playerPhoto || null,\r\n        platform: 'facebook'\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to get Facebook player info:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Generic method to get current user regardless of platform\r\n  async getCurrentUser(firebaseUser: FirebaseUser | null): Promise<PlatformUser | null> {\r\n    if (isFacebookInstantGame()) {\r\n      return this.fromFacebookPlayer();\r\n    } else {\r\n      return firebaseUser ? this.fromFirebaseUser(firebaseUser) : null;\r\n    }\r\n  }\r\n}\r\n\r\nexport const platformAuth = new PlatformAuth();\r\n"],"mappings":"AAAA;AAGA,OAASA,qBAAqB,KAAQ,YAAY,CAUlD,KAAM,CAAAC,YAAa,CACjB;AACAC,gBAAgBA,CAACC,IAAkB,CAAgB,CACjD,MAAO,CACLC,GAAG,CAAED,IAAI,CAACC,GAAG,CACbC,WAAW,CAAEF,IAAI,CAACE,WAAW,CAC7BC,KAAK,CAAEH,IAAI,CAACG,KAAK,CACjBC,QAAQ,CAAEJ,IAAI,CAACI,QAAQ,CACvBC,QAAQ,CAAE,KACZ,CAAC,CACH,CAEA;AACA,KAAM,CAAAC,kBAAkBA,CAAA,CAAiC,CACvD,GAAI,CAACT,qBAAqB,CAAC,CAAC,CAAE,CAC5B,MAAO,KAAI,CACb,CAEA,GAAI,CACF,KAAM,CAAAU,SAAS,CAAGC,MAAM,CAACD,SAAU,CAEnC,GAAI,CAAAE,QAAQ,CAAGF,SAAS,CAACG,MAAM,CAACC,KAAK,CAAC,CAAC,CACvC,GAAI,CAAAC,UAAU,CAAGL,SAAS,CAACG,MAAM,CAACG,OAAO,CAAC,CAAC,CAC3C,KAAM,CAAAC,WAAW,CAAGP,SAAS,CAACG,MAAM,CAACK,QAAQ,CAAC,CAAC,CAE/CC,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAE,CACtCR,QAAQ,CACRG,UAAU,CACVE,WAAW,CACXI,UAAU,CAAEN,UAAU,GAAK,IAAI,CAC/BO,WAAW,CAAEP,UAAU,GAAK,EAC9B,CAAC,CAAC,CAEF;AACA,GAAI,CAACH,QAAQ,CAAE,CACbO,OAAO,CAACI,IAAI,CAAC,sDAAsD,CAAC,CACpE;AACAX,QAAQ,SAAAY,MAAA,CAAWC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE,CACjC,CAEA;AACA;AACA,GAAI,CAACX,UAAU,EAAIA,UAAU,CAACY,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CAC3CR,OAAO,CAACI,IAAI,CAAC,8CAA8C,CAAC,CAC5DR,UAAU,CAAGH,QAAQ,CAACgB,UAAU,CAAC,OAAO,CAAC,CACrC,aAAa,WAAAJ,MAAA,CACHZ,QAAQ,CAACiB,SAAS,CAAC,CAAC,CAAE,CAAC,CAAC,CAAE,CAC1C,CAEAV,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAE,CAAEhB,GAAG,OAAAoB,MAAA,CAAQZ,QAAQ,CAAE,CAAEP,WAAW,CAAEU,UAAW,CAAC,CAAC,CAE7F,MAAO,CACLX,GAAG,OAAAoB,MAAA,CAAQZ,QAAQ,CAAE,CACrBP,WAAW,CAAEU,UAAU,CACvBR,QAAQ,CAAEU,WAAW,EAAI,IAAI,CAC7BT,QAAQ,CAAE,UACZ,CAAC,CACH,CAAE,MAAOsB,KAAK,CAAE,CACdX,OAAO,CAACW,KAAK,CAAC,qCAAqC,CAAEA,KAAK,CAAC,CAC3D,MAAO,KAAI,CACb,CACF,CAEA;AACA,KAAM,CAAAC,cAAcA,CAACC,YAAiC,CAAgC,CACpF,GAAIhC,qBAAqB,CAAC,CAAC,CAAE,CAC3B,MAAO,KAAI,CAACS,kBAAkB,CAAC,CAAC,CAClC,CAAC,IAAM,CACL,MAAO,CAAAuB,YAAY,CAAG,IAAI,CAAC9B,gBAAgB,CAAC8B,YAAY,CAAC,CAAG,IAAI,CAClE,CACF,CACF,CAEA,MAAO,MAAM,CAAAC,YAAY,CAAG,GAAI,CAAAhC,YAAY,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}