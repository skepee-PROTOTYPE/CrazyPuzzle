{"ast":null,"code":"// Platform-aware authentication wrapper\nimport{isFacebookInstantGame}from'./platform';class PlatformAuth{// Convert Firebase user to platform user\nfromFirebaseUser(user){return{uid:user.uid,displayName:user.displayName,email:user.email,photoURL:user.photoURL,platform:'web'};}// Get Facebook Instant Games player as platform user\nasync fromFacebookPlayer(){if(!isFacebookInstantGame()){return null;}try{const FBInstant=window.FBInstant;const playerId=FBInstant.player.getID();let playerName=FBInstant.player.getName();const playerPhoto=FBInstant.player.getPhoto();// getName() might return null if called too early or permission not granted\n// Try to use a more descriptive name if getName() returns null/empty\nif(!playerName||playerName.trim()===''){playerName=\"Player \".concat(playerId.substring(0,8));}return{uid:\"fb_\".concat(playerId),displayName:playerName,photoURL:playerPhoto||null,platform:'facebook'};}catch(error){console.error('Failed to get Facebook player info:',error);return null;}}// Generic method to get current user regardless of platform\nasync getCurrentUser(firebaseUser){if(isFacebookInstantGame()){return this.fromFacebookPlayer();}else{return firebaseUser?this.fromFirebaseUser(firebaseUser):null;}}}export const platformAuth=new PlatformAuth();","map":{"version":3,"names":["isFacebookInstantGame","PlatformAuth","fromFirebaseUser","user","uid","displayName","email","photoURL","platform","fromFacebookPlayer","FBInstant","window","playerId","player","getID","playerName","getName","playerPhoto","getPhoto","trim","concat","substring","error","console","getCurrentUser","firebaseUser","platformAuth"],"sources":["C:/Users/MARCE/source/repos/CrazyPuzzle/web/src/platformAuth.ts"],"sourcesContent":["// Platform-aware authentication wrapper\r\n\r\nimport { User as FirebaseUser } from 'firebase/auth';\r\nimport { isFacebookInstantGame } from './platform';\r\n\r\nexport interface PlatformUser {\r\n  uid: string;\r\n  displayName: string | null;\r\n  email?: string | null;\r\n  photoURL?: string | null;\r\n  platform: 'web' | 'facebook';\r\n}\r\n\r\nclass PlatformAuth {\r\n  // Convert Firebase user to platform user\r\n  fromFirebaseUser(user: FirebaseUser): PlatformUser {\r\n    return {\r\n      uid: user.uid,\r\n      displayName: user.displayName,\r\n      email: user.email,\r\n      photoURL: user.photoURL,\r\n      platform: 'web'\r\n    };\r\n  }\r\n\r\n  // Get Facebook Instant Games player as platform user\r\n  async fromFacebookPlayer(): Promise<PlatformUser | null> {\r\n    if (!isFacebookInstantGame()) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const FBInstant = window.FBInstant!;\r\n      \r\n      const playerId = FBInstant.player.getID();\r\n      let playerName = FBInstant.player.getName();\r\n      const playerPhoto = FBInstant.player.getPhoto();\r\n\r\n      // getName() might return null if called too early or permission not granted\r\n      // Try to use a more descriptive name if getName() returns null/empty\r\n      if (!playerName || playerName.trim() === '') {\r\n        playerName = `Player ${playerId.substring(0, 8)}`;\r\n      }\r\n\r\n      return {\r\n        uid: `fb_${playerId}`,\r\n        displayName: playerName,\r\n        photoURL: playerPhoto || null,\r\n        platform: 'facebook'\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to get Facebook player info:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Generic method to get current user regardless of platform\r\n  async getCurrentUser(firebaseUser: FirebaseUser | null): Promise<PlatformUser | null> {\r\n    if (isFacebookInstantGame()) {\r\n      return this.fromFacebookPlayer();\r\n    } else {\r\n      return firebaseUser ? this.fromFirebaseUser(firebaseUser) : null;\r\n    }\r\n  }\r\n}\r\n\r\nexport const platformAuth = new PlatformAuth();\r\n"],"mappings":"AAAA;AAGA,OAASA,qBAAqB,KAAQ,YAAY,CAUlD,KAAM,CAAAC,YAAa,CACjB;AACAC,gBAAgBA,CAACC,IAAkB,CAAgB,CACjD,MAAO,CACLC,GAAG,CAAED,IAAI,CAACC,GAAG,CACbC,WAAW,CAAEF,IAAI,CAACE,WAAW,CAC7BC,KAAK,CAAEH,IAAI,CAACG,KAAK,CACjBC,QAAQ,CAAEJ,IAAI,CAACI,QAAQ,CACvBC,QAAQ,CAAE,KACZ,CAAC,CACH,CAEA;AACA,KAAM,CAAAC,kBAAkBA,CAAA,CAAiC,CACvD,GAAI,CAACT,qBAAqB,CAAC,CAAC,CAAE,CAC5B,MAAO,KAAI,CACb,CAEA,GAAI,CACF,KAAM,CAAAU,SAAS,CAAGC,MAAM,CAACD,SAAU,CAEnC,KAAM,CAAAE,QAAQ,CAAGF,SAAS,CAACG,MAAM,CAACC,KAAK,CAAC,CAAC,CACzC,GAAI,CAAAC,UAAU,CAAGL,SAAS,CAACG,MAAM,CAACG,OAAO,CAAC,CAAC,CAC3C,KAAM,CAAAC,WAAW,CAAGP,SAAS,CAACG,MAAM,CAACK,QAAQ,CAAC,CAAC,CAE/C;AACA;AACA,GAAI,CAACH,UAAU,EAAIA,UAAU,CAACI,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CAC3CJ,UAAU,WAAAK,MAAA,CAAaR,QAAQ,CAACS,SAAS,CAAC,CAAC,CAAE,CAAC,CAAC,CAAE,CACnD,CAEA,MAAO,CACLjB,GAAG,OAAAgB,MAAA,CAAQR,QAAQ,CAAE,CACrBP,WAAW,CAAEU,UAAU,CACvBR,QAAQ,CAAEU,WAAW,EAAI,IAAI,CAC7BT,QAAQ,CAAE,UACZ,CAAC,CACH,CAAE,MAAOc,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,qCAAqC,CAAEA,KAAK,CAAC,CAC3D,MAAO,KAAI,CACb,CACF,CAEA;AACA,KAAM,CAAAE,cAAcA,CAACC,YAAiC,CAAgC,CACpF,GAAIzB,qBAAqB,CAAC,CAAC,CAAE,CAC3B,MAAO,KAAI,CAACS,kBAAkB,CAAC,CAAC,CAClC,CAAC,IAAM,CACL,MAAO,CAAAgB,YAAY,CAAG,IAAI,CAACvB,gBAAgB,CAACuB,YAAY,CAAC,CAAG,IAAI,CAClE,CACF,CACF,CAEA,MAAO,MAAM,CAAAC,YAAY,CAAG,GAAI,CAAAzB,YAAY,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}